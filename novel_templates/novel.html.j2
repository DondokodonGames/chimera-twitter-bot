<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ story.title }} - CHIMERA Novel</title>
    <link rel="stylesheet" href="../assets/css/novel-base.css">
    <link rel="stylesheet" href="../assets/css/themes/{{ bot_theme }}.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body class="theme-{{ bot_id }}">
    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„Éä -->
    <div id="novel-container" class="novel-container">
        <!-- „Éò„ÉÉ„ÉÄ„Éº -->
        <header class="novel-header">
            <div class="header-content">
                <h1 class="novel-title">{{ story.title }}</h1>
                <div class="header-controls">
                    <button id="menu-btn" class="control-btn">‚â°</button>
                    <button id="save-btn" class="control-btn">üíæ</button>
                    <button id="audio-btn" class="control-btn">üîä</button>
                </div>
            </div>
        </header>

        <!-- „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº -->
        <div class="progress-container">
            <div id="progress-bar" class="progress-bar"></div>
            <span id="progress-text" class="progress-text">1 / {{ story.chapters|length }}</span>
        </div>

        <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç®„É™„Ç¢ -->
        <main class="story-content">
            <!-- „ÉÅ„É£„Éó„Çø„ÉºË°®Á§∫„Ç®„É™„Ç¢ -->
            <div id="chapter-container" class="chapter-container">
                {% for chapter in story.chapters %}
                <section class="chapter" id="chapter-{{ loop.index }}" 
                         data-chapter="{{ loop.index }}"
                         {% if loop.first %}style="display: block;"{% else %}style="display: none;"{% endif %}>
                    
                    <!-- „ÉÅ„É£„Éó„Çø„Éº„Çø„Ç§„Éà„É´ -->
                    {% if chapter.title %}
                    <h2 class="chapter-title">{{ chapter.title }}</h2>
                    {% endif %}

                    <!-- ËÉåÊôØÁîªÂÉè -->
                    {% if chapter.background_image %}
                    <div class="chapter-bg" style="background-image: url('{{ chapter.background_image }}');"></div>
                    {% endif %}

                    <!-- „Ç≠„É£„É©„ÇØ„Çø„ÉºÁ´ã„Å°Áµµ -->
                    {% if chapter.character_image %}
                    <div class="character-sprite">
                        <img src="{{ chapter.character_image }}" alt="{{ chapter.character_name }}" class="character-img">
                    </div>
                    {% endif %}

                    <!-- „ÉÜ„Ç≠„Çπ„Éà„Éú„ÉÉ„ÇØ„Çπ -->
                    <div class="text-box">
                        {% if chapter.speaker %}
                        <div class="speaker-name">{{ chapter.speaker }}</div>
                        {% endif %}
                        
                        <div class="story-text" data-text="{{ chapter.text }}">
                            <!-- „ÉÜ„Ç≠„Çπ„Éà„ÅØJS„Åß1ÊñáÂ≠ó„Åö„Å§Ë°®Á§∫ -->
                        </div>

                        <!-- ÈÅ∏ÊäûËÇ¢ -->
                        {% if chapter.choices %}
                        <div class="choices-container" style="display: none;">
                            {% for choice in chapter.choices %}
                            <button class="choice-btn" data-target="{{ choice.target_chapter }}">
                                {{ choice.text }}
                            </button>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>

                    <!-- BGMË®≠ÂÆö -->
                    {% if chapter.bgm %}
                    <audio data-bgm="{{ chapter.bgm }}" preload="auto"></audio>
                    {% endif %}
                </section>
                {% endfor %}
            </div>

            <!-- „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„Ç≥„É≥„Éà„É≠„Éº„É´ -->
            <div class="nav-controls">
                <button id="prev-btn" class="nav-btn prev-btn" disabled>‚óÄ Êàª„Çã</button>
                <button id="next-btn" class="nav-btn next-btn">Ê¨°„Å∏ ‚ñ∂</button>
                <button id="auto-btn" class="nav-btn auto-btn">Ëá™Âãï</button>
            </div>
        </main>

        <!-- „Çµ„Ç§„Éâ„É°„Éã„É•„Éº -->
        <aside id="side-menu" class="side-menu">
            <div class="menu-content">
                <h3>„É°„Éã„É•„Éº</h3>
                <button class="menu-item" id="chapter-list-btn">„ÉÅ„É£„Éó„Çø„Éº‰∏ÄË¶ß</button>
                <button class="menu-item" id="settings-btn">Ë®≠ÂÆö</button>
                <button class="menu-item" id="restart-btn">ÊúÄÂàù„Åã„Çâ</button>
                <button class="menu-item" id="close-menu-btn">Èñâ„Åò„Çã</button>
            </div>
        </aside>

        <!-- Ë®≠ÂÆö„Éë„Éç„É´ -->
        <div id="settings-panel" class="settings-panel">
            <div class="settings-content">
                <h3>Ë®≠ÂÆö</h3>
                <div class="setting-group">
                    <label>„ÉÜ„Ç≠„Çπ„ÉàÈÄüÂ∫¶</label>
                    <input type="range" id="text-speed" min="1" max="5" value="3">
                </div>
                <div class="setting-group">
                    <label>BGMÈü≥Èáè</label>
                    <input type="range" id="bgm-volume" min="0" max="100" value="50">
                </div>
                <div class="setting-group">
                    <label>„Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫</label>
                    <select id="font-size">
                        <option value="small">Â∞è</option>
                        <option value="medium" selected>‰∏≠</option>
                        <option value="large">Â§ß</option>
                    </select>
                </div>
                <button id="close-settings-btn" class="close-btn">Èñâ„Åò„Çã</button>
            </div>
        </div>

        <!-- „É≠„Éº„Éá„Ç£„É≥„Ç∞ÁîªÈù¢ -->
        <div id="loading-screen" class="loading-screen">
            <div class="loading-content">
                <div class="spinner"></div>
                <p>Ë™≠„ÅøËæº„Åø‰∏≠...</p>
            </div>
        </div>
    </div>

    <!-- „Çπ„ÇØ„É™„Éó„Éà -->
    <script>
        // ÂàùÊúüÂåñ„Éá„Éº„Çø
        window.NOVEL_DATA = {
            botId: '{{ bot_id }}',
            storyData: {{ story | tojson }},
            totalChapters: {{ story.chapters|length }},
            currentChapter: 1,
            autoPlayEnabled: false,
            settings: {
                textSpeed: 3,
                bgmVolume: 50,
                fontSize: 'medium'
            }
        };
    </script>
    <script src="../assets/js/audio-manager.js"></script>
    <script src="../assets/js/save-manager.js"></script>
    <script src="../assets/js/novel-engine.js"></script>
</body>
</html>
